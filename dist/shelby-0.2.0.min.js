/*
 * Shelby JavaScript library v0.2.0
 * (c) Patrick Lafrance - https://github.com/patricklafrance/shelby
 * License: MIT (http://www.opensource.org/licenses/mit-license.php) 
 */

!function(e){"use strict";if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var t=e(require("jquery"),require("knockout"),require("knockout.viewmodel"));"object"==typeof exports&&(exports=t),"object"==typeof module&&(module.exports=t)}else if("function"==typeof define&&define.amd)define("shelby",["jquery","knockout","knockout.viewmodel"],e);else{var n=window||global;n.Shelby=e(n.jQuery,n.ko,n.ko.viewmodel)}}(function(e,t,n){"use strict";var r={};return r.version="0.2.0",r.namespace="shelby",r.debug=!1,function(t,n){var i=e.isFunction(Object.hasOwnProperty),s=e.isFunction(Object.keys),o=e.isFunction(Array.prototype.indexOf),a=e.isFunction(Array.prototype.map),u=0;r.utils={isUndefined:function(e){return e===n},isNull:function(e){return this.isUndefined(e)||null===e},isNullOrEmpty:function(e){return this.isNull(e)||""===e},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isObject:function(t){return e.isFunction(t)||e.isArray(t)?!1:t===Object(t)},isjQueryElement:function(e){return e instanceof jQuery},isDomElement:function(e){try{if("html"===e.ownerDocument.documentElement.tagName.toLowerCase())return!0}catch(t){}return!1},hasOwnProperty:function(e,t){return i?e.hasOwnProperty(t):t in e},hasProperty:function(e,t){return t in e},clonePlainObject:function(t){return e.extend(!0,{},t)},cloneArray:function(e){return e.slice(0)},arrayIndexOf:function(e,t,n,r){if(!o||n){this.isNull(n)&&(n=function(e){return e===t});for(var i=0,s=e.length;s>i;i+=1)if(n.apply(r,[e[i],t])===!0)return i;return-1}return e.indexOf(t)},arrayGetValue:function(e,t,n){var r=this.arrayIndexOf(e,t,n);return-1!==r?e[r]:null},arrayRemoveIndex:function(e,t){e.splice(t,1)},arrayRemoveValue:function(e,t,n){var r=this.arrayIndexOf(e,t,n);-1!==r&&this.arrayRemoveIndex(e,r)},arrayClear:function(e){for(;e.length>0;)e.pop()},arrayMap:function(e,t,n){if(!a){for(var r=[],i=0,s=e.length;s>i;i+=1)r.push(t.apply(n,[e[i],i,e]));return r}return e.map(t,n)},arrayMapToObject:function(e,t,n){for(var r={},i=0,s=e.length;s>i;i+=1)r[e[i][t]]=e[i][n];return r},objectMap:function(e,t,n){var r={};for(var i in e)this.hasOwnProperty(e,i)&&(r[i]=t.apply(n,[e[i],i,e]));return r},objectKeys:function(e){if(!s){var t=[];for(var n in e)this.hasOwnProperty(e,n)&&t.push(n);return t}return Object.keys(e)},objectSize:function(e){return this.objectKeys(e).length},isImplementing:function(e,t){if(0===t.length)return!1;for(var n=0,r=t.length;r>n;n+=1)if(!(t[n]in e))return!1;return!0},isPartiallyImplementing:function(e,t){for(var n=0,r=t.length;r>n;n+=1)if(t[n]in e)return!0;return!1},isImplementingShelby:function(e){return this.hasProperty(e,t)},stringFormat:function(){var e=arguments,t=e[0];return t.replace(/\{(\d+)\}/g,function(t,n){return e[n]})},stringContains:function(e,t){return-1!==e.indexOf(t)},stringStartsWith:function(e,t){return 0===e.indexOf(t)},stringEndsWith:function(e,t){return-1!==e.indexOf(t,e.length-t.length)},stringEnsureEndsWith:function(e,t){return this.stringEndsWith(e,t)?e:e+t},debug:function(e){if(this.isNull(console.log))throw new Error(e);console.log(e)},generateGuid:function(){return u+=1,"__shelby__"+u}}}(r.namespace),function(t){r.extend=function(){if(0===arguments.length)throw new Error("At least 1 non-null plain object is required to extend a Shelby object.");var n=[];e.each(arguments,function(e,r){if(!t.isObject(r))throw new Error("Only non-null literal or prototyped object can extend a Shelby object.");n.push(t.isNull(r.prototype)?r:r.prototype)});var i=this,s=null,o=e.extend.apply(e,[!0,{},i.prototype].concat(n));return s=e.isFunction(o._initialize)?function(){i.apply(this,arguments),e.isFunction(o._initialize)&&o._initialize.apply(this,arguments)}:function(){i.apply(this,arguments)},s.prototype=o,s.prototype._super=i.prototype,s.extend=r.extend,s}}(r.utils),function(t,n){var i=r.ComponentsFactory=function(){this._components={},this._instances={}};r.ComponentsFactory.prototype={registerComponent:function(t,r){if(n.isNullOrEmpty(t))throw new Error('"name" must be a non-null or empty component name.');if(!e.isFunction(r))throw new Error('"factory" must be a function to create instances of the component.');this._components[t]=r},getComponent:function(t){var r=this._instances[t];if(n.isNull(r)){var i=this._components[t];if(!e.isFunction(i))throw new Error(n.stringFormat("Cannot find a component factory for {1}",t));r=this._instances[t]=i()}return r}},i.extend=t,r.components={_factory:null,setComponentFactory:function(e){if(n.isNull(e))throw new Error('"factory" must be an object.');this._factory=e},registerComponent:function(e,t){var n=this;this._factory.registerComponent(e,t),this[e]=function(){return n._factory.getComponent(e)}}},r.components.setComponentFactory(new i)}(r.extend,r.utils),function(n,i){r.Parser=function(){this._current=null,this._options=null,this._context=null},r.Parser.prototype={parse:function(e,t,n){if(i.isNull(e))throw new Error('"obj" must be a non-null object.');this._reset(e,t,n),this._next("{root}",e,"",null)},_reset:function(e,t,n){this._current=e,this._options=this._computeOptions(t),this._context=n},_computeOptions:function(t){return t=i.isNull(t)?{}:i.clonePlainObject(t),e.isFunction(t.filter)||(t.filter=function(){return!0}),t},_next:function(t,n,r,s){var o=this._augmentPath(r,t);return this._options.filter.apply(this,[t,n,r])?this._isArray(n)?this._array(t,n,o,s):i.isObject(n)?this._object(t,n,o,s):e.isFunction(n)?this._scalar(t,n,o,s,this._options.onFunction):this._scalar(t,n,o,s,this._options.onPrimitive):!0},_object:function(e,t,n,r){var s=this._scalar(e,t,n,r,this._options.onObject);if(s!==!1)for(var o in t)if(i.hasOwnProperty(t,o)&&(s=this._next(o,t[o],n,t),s===!1))break;return s},_array:function(e,n,r,i){var s=this._scalar(e,n,r,i,this._options.onArray);if(s!==!1)for(var o=t.utils.peekObservable(n),a=0,u=o.length;u>a&&(s=this._next("[i]",o[a],r,n),s!==!1);a+=1);return s},_scalar:function(t,n,r,i,s){if(e.isFunction(s)){var o={key:t,value:n,path:r,parent:i,obj:this._current};return s.call(this._context,o)}},_isArray:function(n){return n=t.utils.peekObservable(n),e.isArray(n)},_augmentPath:function(e,t){return"{root}"===t?t:"[i]"===t?e+t:i.stringFormat("{1}.{2}",e,t)}},r.Parser.extend=n,r.components.registerComponent("parser",function(){return new r.Parser})}(r.extend,r.utils),function(n,i,s){r.Filters=function(){},r.Filters.prototype={getExtendablePropertyFilter:function(){return function(e,r){return e!==n&&(t.isObservable(r)||s.isObject(r))}},getExtendedPropertyFilter:function(){return function(e,r){return e!==n&&(t.isObservable(r)||s.isObject(r))&&s.isImplementingShelby(r)}},getPathFilter:function(t,n){return e.isArray(t)?this._getIncludePathFilter(t):e.isArray(n)?this._getExcludePathFilter(n):this._getDefaultPathFilter()},_getIncludePathFilter:function(e){var t=this,n=this._computeEvaluators(e);return function(e){var r=null,i=!1,o=function(t){return r=t(e),r.isValid&&!r.isPerfectMatch?(i=!0,!1):r.isValid};return-1===s.arrayIndexOf(n,e,o)?i?t._createImperfectMatchEvaluationResult():t._createInvalidEvaluationResult():r}},_getExcludePathFilter:function(e){var t=this,n=this._computeEvaluators(e);return function(e){var r=function(t){var n=t(e);return n.isValid&&n.isPerfectMatch};return-1===s.arrayIndexOf(n,e,r)?t._createPerfectMatchEvaluationResult():t._createInvalidEvaluationResult()}},_getDefaultPathFilter:function(){var e=this;return function(){return e._createPerfectMatchEvaluationResult()}},_computeEvaluators:function(e){var t=this;return s.arrayMap(e,function(e){if(s.stringStartsWith(e,"{root}")){if(s.stringEndsWith(e,"[i]")){var n=null;try{n=new RegExp(e.replace(/\[i\]/g,"[^]+"))}catch(r){n=new RegExp(e.replace(/\[i\]/g,"[^]]+"))}return function(r){return n.test(r)?t._createPerfectMatchEvaluationResult():t._isArrayPath(e,r)?t._createImperfectMatchEvaluationResult():t._createInvalidEvaluationResult()}}return function(n){return e===n?t._createPerfectMatchEvaluationResult():t._isArrayPath(e,n)?t._createImperfectMatchEvaluationResult():t._createInvalidEvaluationResult()}}return function(n){return s.stringContains(n,e)?t._isArrayPath(e,n)?t._createImperfectMatchEvaluationResult():t._createPerfectMatchEvaluationResult():t._createInvalidEvaluationResult()}})},_createInvalidEvaluationResult:function(){return this._createEvaluationResult(!1,!1)},_createImperfectMatchEvaluationResult:function(){return this._createEvaluationResult(!0,!1)},_createPerfectMatchEvaluationResult:function(){return this._createEvaluationResult(!0,!0)},_createEvaluationResult:function(e,t){return{isValid:e,isPerfectMatch:t}},_isArrayPath:function(e,t){return-1!==e.indexOf(t+"[i]")}},r.Filters.extend=i,r.components.registerComponent("filters",function(){return new r.Filters})}(r.namespace,r.extend,r.utils),function(t,n){r.ExtenderRegistry=function(){this._extenders={},this._cache={}},r.ExtenderRegistry.prototype={add:function(t,r,i){if(n.isNullOrEmpty(t))throw new Error('"name" must be a non null or empty string.');if(!e.isFunction(r))throw new Error('"extender" must be a function that extend a property.');n.isNullOrEmpty(i)&&(i="*"),this._addExtender(i,t,r)},_addExtender:function(e,t,r){n.isNull(this._extenders[e])&&(this._extenders[e]={}),n.isNull(this._extenders[e][t])&&(this._extenders[e][t]={}),this._extenders[e][t]=r,this._invalidCache()},remove:function(e,t){if(n.isNullOrEmpty(e))throw new Error('"name" must be a non null or empty string.');n.isNullOrEmpty(t)&&(t="*"),n.isNull(this._extenders[t])||(n.isNull(this._extenders[t][e])||delete this._extenders[t][e],0===n.objectSize(this._extenders[t])&&delete this._extenders[t],this._invalidCache())},getExtenders:function(e){n.isNullOrEmpty(e)&&(e="*");var t=this._cache[e];if(n.isNull(t)){if(t=[],!n.isNull(this._extenders[e]))for(var r in this._extenders[e])t.push(this._extenders[e][r]);this._cache[e]=t}return t},_invalidCache:function(){this._cache={}}},r.ExtenderRegistry.extend=t,r.components.registerComponent("extenderRegistry",function(){return new r.ExtenderRegistry}),r.registerExtender=function(e,t,n){r.components.extenderRegistry().add(e,t,n)},r.removeExtender=function(e,t){r.components.extenderRegistry().remove(e,t)}}(r.extend,r.utils),function(t,n,i){var s=r.PropertyType={Object:0,Array:1,Scalar:2};r.Extenders={},r.Extenders.base=function(e){i.isNull(this._target)&&(this._target=function(){return e})},r.Extenders.base.extend=n,r.PropertyExtender=function(){},r.PropertyExtender.prototype={add:function(e,n){if(i.isNull(e))throw new Error('"target" must be an object.');if(i.isNull(n))throw new Error('"extenders" must be an object literal.');if(!i.hasProperty(e,t)){var o=this,a=function(e){return function(t){o._extendProperty(t,e,n)}};r.components.parser().parse(e,{filter:r.components.filters().getExtendablePropertyFilter(),onObject:a(s.Object),onArray:a(s.Array),onFunction:a(s.Scalar)})}},remove:function(e){if(i.isNull(e))throw new Error('"target" must be an object.');var n=function(e){delete e.value[t]};r.components.parser().parse(e,{filter:r.components.filters().getExtendedPropertyFilter(),onObject:n,onArray:n,onFunction:n})},_extendProperty:function(n,r,s){n.value[t]={};var o=s["*"]||{};i.isObject(s[n.path])&&e.extend(o,s[n.path]),e.each(o,function(){this.apply(this,[n.value,r])})}},r.PropertyExtender.extend=n,r.components.registerComponent("propertyExtender",function(){return new r.PropertyExtender})}(r.namespace,r.extend,r.utils),function(n,i,s){var o=r.PropertyType;t.extenders.shelbySubscribe=function(t){var r=!1;return e.extend(t[n],{subscribe:function(n){if(!e.isFunction(n))throw new Error("First argument must be a callback function.");var i=n;arguments[0]=function(e){r||o.isPause||i.apply(this,[e])};var s=t.subscribe.apply(t,arguments),o={isPause:!1,pause:function(){this.isPause=!0},resume:function(){this.isPause=!1},dispose:function(){s.dispose()}};return o},pause:function(){r=!0},resume:function(){r=!1},isPause:function(){return r}}),t},t.extenders.shelbyArraySubscribe=function(t){var r=t[n].subscribe;if(!e.isFunction(r))throw new Error('The observable must be extended with "ko.extenders.shelbySubscribe".');e.extend(t[n],{subscribe:function(t){var n=!s.isObject(arguments[3])||arguments[3].evaluateChanges!==!1;if(n){if(!e.isFunction(t))throw new Error("First argument must be a callback function.");var i=t;arguments[0]=function(e){i.apply(this,[{value:e},!0,"shelbyArraySubscribe"])},arguments[2]="arrayChange"}return r.apply(this,arguments)}})},r.Extenders.subscribe=function(t,i){if(i!==o.Object){if(t.extend(this._observableExtenders["*"]),i===o.Array){var a=this._observableExtenders.array;s.isNull(a)||t.extend(a)}t[n]._subscriptions={}}i===o.Object&&e.extend(t[n],new r.Extenders.subscribe._ctor(t))},r.Extenders.subscribe._ctor=r.Extenders.base.extend({_initialize:function(){this._delegatedSubscriptions={}},subscribe:function(e,t){if(s.isNull(e))throw new Error('"callback" must be a function.');var n=this;t=t||{},t.array=t.array||{};var i=r.components.filters().getPathFilter(t.include,t.exclude),o={id:s.generateGuid(),members:[],isPause:!1,callback:e,pause:function(){n._pauseSubscription(this)},resume:function(){n._resumeSubscription(this)},dispose:function(){n._disposeSubscription(this)}};return this._addToSubscription(this._target(),o,i,t,{path:""}),o.members.length>0&&(this._delegatedSubscriptions[o.id]=o),o},_addToSubscription:function(t,i,o,a,u){var l=this,c=e.isFunction(a.subscriber)?a.subscriber:this._propertySubscriber,p=function(t){if(s.isImplementingShelby(t.value)){var r=s.isNullOrEmpty(u.path)?t.path:s.stringFormat("{1}{2}",u.path,t.path.replace("{root}","")),p=s.isNull(u.parent)?t.parent:u.parent,f=o(r);if(f.isValid){var d=function(n,s,u){var c={path:r,parent:p,subscription:i};e.extend(c,s===!0?n:{value:n}),"shelbyArraySubscribe"===u&&a.array.trackChildren!==!1&&e.each(n.value,function(){"added"===this.status?l._addToSubscription(this.value,i,o,a,{path:r+"[i]",parent:t.value}):"deleted"===this.status&&l._removeFromSubscription(this.value,i)}),f.isPerfectMatch&&i.callback.call(this,c)},h=c(t,d,a);t.value[n]._subscriptions[i.id]=h,i.members.push(t.value)}}};r.components.parser().parse(t,{filter:r.components.filters().getExtendedPropertyFilter(),onArray:p,onFunction:p})},_removeFromSubscription:function(e,t){var i=function(e){var r=e.value[n]._subscriptions[t.id];s.isNull(r)||(r.dispose(),delete e.value[n]._subscriptions[t.id],s.arrayRemoveValue(t.members,e.value))};r.components.parser().parse(e,{filter:r.components.filters().getExtendedPropertyFilter(),onArray:i,onFunction:i})},_propertySubscriber:function(t,r,i){var o=null;return!e.isArray(t.value.peek())||i.array.evaluateChanges!==!1&&s.isNullOrEmpty(i.event)||(o={evaluateChanges:!1}),t.value[n].subscribe(r,i.callbackTarget,i.event,o)},_pauseSubscription:function(e){this._executeSubscriptionOperation(e,function(e){e.pause()}),e.isPause=!0},_resumeSubscription:function(e){this._executeSubscriptionOperation(e,function(e){e.resume()}),e.isPause=!1},_disposeSubscription:function(e){this._executeSubscriptionOperation(e,function(e){e.dispose()}),s.arrayClear(e.members),delete this._delegatedSubscriptions[e.id]},_executeSubscriptionOperation:function(t,r){e.each(t.members,function(){var e=this[n]._subscriptions[t.id];s.isNull(e)||r(e)})},unsuscribeAll:function(){var t=this;e.each(this._delegatedSubscriptions,function(){t._disposeSubscription(this)})},mute:function(){var t=this;e.each(this._delegatedSubscriptions,function(){t._pauseSubscription(this)})},unmute:function(){var t=this;e.each(this._delegatedSubscriptions,function(){t._resumeSubscription(this)})}}),r.Extenders.subscribe._ctor.extend=i,r.Extenders.subscribe._observableExtenders={"*":{shelbySubscribe:!0},array:{shelbyArraySubscribe:!0}}}(r.namespace,r.extend,r.utils),function(n,i,s){var o=r.PropertyType;t.extenders.shelbyEdit=function(r){if(!e.isFunction(r[n].pause)||!e.isFunction(r[n].resume))throw new Error(s.stringFormat('"shelbyEditable" can only extends an observable having "{1}.pause" and "{1}.resume" functions.',n));var i=!1;return e.extend(r[n],{current:r.peek(),hasMutated:!1,isEditing:!1,deferNotifications:!1,beginEdit:function(e){this.isEditing||(this.current=r.peek(),this.deferNotifications=e!==!1?!0:!1,this.deferNotifications&&(i=r[n].isPause(),i||r[n].pause()),this.isEditing=!0)},endEdit:function(e){var t=this;if(this.isEditing&&this.hasMutated&&(this.current=r.peek()),this.isEditing&&!i&&this.deferNotifications!==!1){var s=t.hasMutated;setTimeout(function(){r[n].resume(),s&&e!==!1&&(r.valueWillMutate(),r.valueHasMutated())},10)}this.hasMutated=!1,this.isEditing=!1},resetEdit:function(){this.isEditing&&this.hasMutated&&r(this.current)},cancelEdit:function(){r[n].resetEdit(),this.isEditing&&(i||this.deferNotifications===!1||setTimeout(function(){r[n].resume()},10)),this.isEditing=!1,this.hasMutated=!1}}),r.subscribe(function(i){s.isNull(r[n])||!r[n].isEditing||r[n].hasMutated||(r[n].hasMutated=e.isArray(i)?0===t.utils.compareArrays(r[n].current,i).length:i!==r[n].current)}),r},r.Extenders.edit=function(t,i){i!==o.Object&&t.extend(this._observableExtenders),i===o.Object&&e.extend(t[n],new r.Extenders.edit._ctor(t))},r.Extenders.edit._ctor=r.Extenders.base.extend({_initialize:function(){this.isEditing=!1,this._editOptions=null},beginEdit:function(e){this.isEditing||(this._editOptions=e||{},this._executeEditAction(function(e){e.value[n].beginEdit(this._editOptions.deferNotifications)}),this.isEditing=!0)},endEdit:function(e){if(this.isEditing){var t=null;if(e===!0){if(this._editOptions.deferNotifications===!0)throw new Error('The "notify once" options is not supported when the edition has been started with the "defer notifications" disabled.');t=function(e){return 1===e.count}}else t=function(){return!0};var r=function(e,r){e.value[n].isEditing===!0&&(e.value[n].hasMutated&&(r.count+=1),e.value[n].endEdit(t(r)))};this._executeEditAction(r,{count:0}),this.isEditing=!1}},resetEdit:function(){this.isEditing&&this._executeEditAction(function(e){e.value[n].isEditing===!0&&e.value[n].resetEdit()})},cancelEdit:function(){this.isEditing&&(this._executeEditAction(function(e){e.value[n].isEditing===!0&&e.value[n].cancelEdit()}),this.isEditing=!1)},hasMutated:function(){var e=!1;return this.isEditing&&this._executeEditAction(function(t){return t.value[n].hasMutated?(e=!0,!1):void 0}),e},_executeEditAction:function(e,t){var n=this,i=r.components.filters().getPathFilter(this._editOptions.include,this._editOptions.exclude),s=function(r){return i(r.path).isPerfectMatch?e.apply(n,[r,t]):void 0};r.components.parser().parse(this._target(),{filter:r.components.filters().getExtendedPropertyFilter(),onArray:s,onFunction:s})}}),r.Extenders.edit._ctor.extend=i,r.Extenders.edit._observableExtenders={shelbyEdit:!0}}(r.namespace,r.extend,r.utils),function(t,n,i){var s=r.PropertyType;r.Extenders.utility=function(n,i){i!==s.Scalar&&e.extend(n[t],new r.Extenders.utility._ctor(n))},r.Extenders.utility._ctor=r.Extenders.base.extend({reset:function(){var e=null,t={};i.isObject(arguments[1])?(e=arguments[0],t=arguments[1]):i.isObject(arguments[0])?t=arguments[0]:arguments.length>0&&(e=arguments[0]);var n=function(n){n.value(i.hasProperty(t,n.path)?t[n.path]:e)};r.components.parser().parse(this._target(),{filter:r.components.filters().getExtendedPropertyFilter(),onFunction:n})},updateFrom:function(e){if(!i.isObject(e))throw new Error('"obj" must be an object.');try{r.components.mapper().update(this._target(),e)}catch(t){throw new Error("An error occurred while updating the target object. Make sure that all the observables properties of the target object has been created by the Shelby mapper.")}}}),r.Extenders.utility._ctor.extend=n}(r.namespace,r.extend,r.utils),function(t,n,i){var s=r.Ajax=function(){};s.prototype={send:function(n){if(i.isNull(n))throw new Error('"options" must be a non null object literal.');if(i.isNullOrEmpty(n.url))throw new Error('"options.url" must be a non null or empty string.');if(i.isNullOrEmpty(n.type))throw new Error('"options.type" must be a non null or empty string.');var r=e.extend({},e.ajaxSettings,s.options,n),o=i.isObject(n.data);o||(r.contentType=null),"GET"!==n.type&&o&&i.stringContains(r.contentType,"application/json")&&(r.data=JSON.stringify(r.data));var a=e.ajax(r);return t===!0&&a.fail(this._onRequestFail),a},_onRequestFail:function(e,t,n){var r=i.isNullOrEmpty(this.data)?"{NO_DATA}":JSON.stringify(this.data),s=i.isNullOrEmpty(t)?"{NO_EXCEPTION}":t,o=i.isNullOrEmpty(n)?"{NO_HTTP_ERROR}":n,a=i.stringFormat("An error occurred while performing an AJAX request of type {1} to {2} with data {3}.\nStatus code: {4}\nStatus text: {5}\nException: {6}\nHTTP error: {7}",this.type,this.url,r,e.status,e.statusText,s,o);i.debug(a)}},s.options=e.extend({},e.ajaxSettings,{contentType:"application/json",cache:!1}),s.extend=n,r.components.registerComponent("ajax",function(){return new s})}(r.debug,r.extend,r.utils),function(e){r.Mapper=function(){},r.Mapper.prototype={fromJS:function(){return n.fromModel.apply(n,arguments)},toJS:function(){return n.toModel.apply(n,arguments)},update:function(){return n.updateFromModel.apply(n,arguments)}},r.Mapper.extend=e,r.components.registerComponent("mapper",function(){return new r.Mapper})}(r.extend),r._ViewModel={},function(n){r._ViewModel.Bindable={_beforeBind:null,_afterBind:null,bind:function(t){var n=this,r=new e.Deferred,i=function(){n._applyBindings(),r.resolve()};if(this.element=this._getDomElement(t),e.isFunction(this._beforeBind)){var s=this._beforeBind.call(this,i);s!==!0&&i()}else i();return r.promise()},_getDomElement:function(e){return n.isjQueryElement(e)&&e.length>0&&(e=e[0]),e},_applyBindings:function(){t.applyBindings(this,this.element),e.isFunction(this._afterBind)&&this._afterBind.call(this)},_disposeBindings:function(){n.isDomElement(this.element)&&t.dataFor(this.element)&&t.cleanNode(this.element)}}}(r.utils),function(){r._ViewModel.Disposable={_handleDispose:null}}(),function(e,t){r._ViewModel.Extendable={_fromJS:function(e,t,n){var i=r.components.mapper().fromJS(e,t);return this._applyExtendersToObject(i,n),i},_toJS:function(e){var t=r.components.mapper().toJS(e);return this._removeExtendersFromObject(t),t},_applyExtendersToObject:function(e,n){t.isNull(n)&&(n=this._extenders),t.objectSize(n)>0&&r.components.propertyExtender().add(e,n)},_removeExtendersFromObject:function(e){r.components.propertyExtender().remove(e)},_disposeAllSubscriptions:function(){var n=function(n){t.hasProperty(n.value,e)&&t.hasProperty(n.value[e],"unsuscribeAll")&&n.value[e].unsuscribeAll()};r.components.parser().parse(this,{filter:r.components.filters().getExtendedPropertyFilter(),onObject:n})}},r._ViewModel.Extendable._extenders={"*":{utility:r.Extenders.utility,subscribe:r.Extenders.subscribe,edit:r.Extenders.edit}}}(r.namespace,r.utils),function(t){function n(t,n){e.isFunction(t)&&t.apply(this,n)}r._ViewModel.HttpEvent={_beforeFetch:null,_beforeSave:null,_beforeRemove:null,_afterFetch:null,_afterSave:null,_afterRemove:null,_handleOperationError:null,_handleOperationSuccess:null,_notify:function(e,t){switch(e){case i.BeforeFetch:n(this._beforeFetch,t);break;case i.BeforeSave:n(this._beforeSave,t);break;case i.BeforeRemove:n(this._beforeRemove,t);break;case i.AfterFetch:n(this._afterFetch,t);break;case i.AfterSave:n(this._afterSave,t);break;case i.AfterRemove:n(this._afterRemove,t);break;case i.OperationError:n(this._handleOperationError,t);break;case i.OperationSuccess:n(this._handleOperationSuccess,t)}r.components.eventManager().notifyHandlers(e,t,this)}};var i=r.HttpEvent={BeforeFetch:"beforeFetch",BeforeSave:"beforeSave",BeforeRemove:"beforeRemove",AfterFetch:"afterFetch",AfterSave:"afterSave",AfterRemove:"afterRemove",OperationError:"operationError",OperationSuccess:"operationSuccess"},s=r.OperationMethod={Get:"GET",Post:"POST",Put:"PUT",Delete:"DELETE",fromHttpVerb:function(e){var t=s.Get;return"POST"===e?t=s.Post:"PUT"===e?t=s.Put:"DELETE"===e&&(t=s.Delete),t}};r.OperationContext=function(e){this.url=e.url,this.method=s.fromHttpVerb(e.type),this.data=e.data},r.RequestError=function(e,n,r){var i=null;i=t.isNull(n.responseJSON)?t.isNull(n.responseXML)?n.responseText:n.responseXML:n.responseJSON,e.statusCode=n.status,e.statusText=n.statusText,e.exception=r,this.operationContext=e,this.response=i}}(r.utils),function(t,n){var i=r.HttpEvent,s=r.OperationContext,o=r.RequestError;r._ViewModel.Http={_url:null,_send:function(t,a){if(n.isNullOrEmpty(t.request.url))throw new Error('"options.request.url" must be a non null or empty string.');var u=this,l=e.extend({context:this},t.request),c=new s(l);e.isFunction(a.onBefore)&&(l.beforeSend=function(){var t=e.makeArray(arguments);return t.unshift(c),a.onBefore.apply(u,t)}),n.isObject(l.data)&&(l.data=this._toJS(l.data));var p=r.components.ajax().send(l),f=e.Deferred();return p.done(function(r){n.isNull(r)||(t.response=t.response||{},t.response.process!==!1&&(e.isFunction(t.response.extractor)&&(r=t.response.extractor.call(u,r)),e.isFunction(a.onResponse)&&(r=a.onResponse.apply(u,[r,t])))),f.resolveWith(this,[r]),e.isFunction(u._notify)&&u._notify.call(u,i.OperationSuccess,[c])}),p.fail(function(t,n){var r=[new o(c,t,n)];f.rejectWith(this,r),e.isFunction(u._notify)&&u._notify.call(u,i.OperationError,r)}),e.isFunction(a.onAfter)&&p.always(function(){var t=e.makeArray(arguments);t.unshift(c),a.onAfter.apply(u,t)}),f.promise()},_fetch:function(t){var r=this;if(n.isNull(t))throw new Error('"options" must be a non null object literal.');if(n.isNull(t.request))throw new Error('"options.request" must be a non null object literal.');return t.request.type=t.request.type||"GET",this._send(t,{onBefore:function(){e.isFunction(this._notify)&&r._notify.call(r,i.BeforeFetch,arguments)},onAfter:function(){e.isFunction(this._notify)&&r._notify.call(r,i.AfterFetch,arguments)},onResponse:function(e){return this._fromJS(e,t.response.mapping,t.response.extenders)}})},_save:function(t){var s=this;if(n.isNull(t))throw new Error('"options" must be a non null object literal.');if(n.isNull(t.request))throw new Error('"options.request" must be a non null object literal.');if(n.isNullOrEmpty(t.request.type))throw new Error('"options.request.type" must be a non nullor empty string.');return this._send(t,{onBefore:function(){e.isFunction(s._notify)&&s._notify.call(s,i.BeforeSave,arguments)},onAfter:function(){e.isFunction(s._notify)&&s._notify.call(s,i.AfterSave,arguments)},onResponse:function(e,t){return n.isObject(t.request.data)&&n.isObject(e)&&r.components.mapper().update(t.request.data,e),e}})},_remove:function(t){var r=this;if(n.isNull(t))throw new Error('"options" must be a non null object literal.');if(n.isNull(t.request))throw new Error('"options.request" must be a non null object literal.');return t.request.type=t.request.type||"DELETE",this._send(t,{onBefore:function(){e.isFunction(r._notify)&&r._notify.call(r,i.BeforeRemove,arguments)},onAfter:function(){e.isFunction(r._notify)&&r._notify.call(r,i.AfterRemove,arguments)}})},all:function(t,n){var r=this._getUrl("all"),i={request:{url:r.value,data:t},response:n};return this._fetch(e.extend({},i,n))},detail:function(t,r){if(n.isNullOrEmpty(t))throw new Error('"id" must be a non null or empty string.');var i=this._getUrl("detail"),s={request:{url:i.value,data:{id:t}}};return this._fetch(e.extend(s,r))},add:function(t,r){if(n.isNull(t))throw new Error('"model" must be a non null object.');var i=this._getUrl("add"),s={request:{url:i.value,type:"POST",data:t}};return this._save(e.extend(s,r))},update:function(){var t=null,r=null,i=null,s=this._getUrl("update"),o=s.type===a.Rest;if(o)switch(arguments.length){case 3:t=arguments[0],r=arguments[1],i=arguments[2];break;case 2:n.isString(arguments[0])?(t=arguments[0],r=arguments[1]):(r=arguments[0],i=arguments[1]);break;default:r=arguments[0]}else r=arguments[0],i=arguments[1];if(n.isNull(r)||!n.isObject(r))throw new Error('"model" must be a non null object.');o&&n.isString(t)&&(s.value=n.stringFormat("{1}/{2}",s.value,t));var u={request:{url:s.value,type:o?"PUT":"POST",data:r}};return this._save(e.extend(u,i))},remove:function(t,r){var i=this._getUrl("remove"),s=i.type===a.Rest;if(s)if(n.isString(t)){if(n.isNullOrEmpty(t))throw new Error('"target" id must be a non empty string.');i.value=n.stringFormat("{1}/{2}",i.value,t)}else if(!n.isObject(t))throw new Error('"target" must be a non null or empty string identifier or a non null object model.');var o={request:{url:i.value,type:s?"DELETE":"POST",data:n.isObject(t)?t:null}};return this._remove(e.extend(o,r))},_getUrl:function(e){if(!n.isNullOrEmpty(this._url)){if(n.isString(this._url))return{value:this._url,type:a.Rest};if(n.isObject(this._url)){var t=this._url[e];if(n.isNullOrEmpty(t))throw new Error(n.stringFormat('The URL for the operation "{1}" is not specified.',e));return{value:t,type:a.Rpc}}}throw new Error('To use any of the AJAX operations, the "_url" property must be a non-null/empty string or a non-null object literal.')}};var a=r.UrlType={Rest:"REST",Rpc:"RPC"}}(r.extend,r.utils),function(t,n){r.EventManager=function(){this._eventHandlers={}},r.EventManager.prototype={notifyHandlers:function(t,r,i){if(n.isNullOrEmpty(t))throw new Error('"eventName" must be a non null or empty string.');var s=this._eventHandlers[t];if(e.isArray(s))for(var o=0,a=s.length;a>o;o+=1)s[o].callback.apply(i,r)},registerEventHandler:function(t,r){if(n.isNullOrEmpty(t))throw new Error('"eventName" must be a non null or empty string.');if(!e.isFunction(r))throw new Error('"callback" must be a function.');if(n.stringContains(t,".")){var i=this._parseEventName(t);this._addEventHandler(i.event,i.name,r)}else this._addEventHandler(t,null,r)},_addEventHandler:function(t,n,r){e.isArray(this._eventHandlers[t])||(this._eventHandlers[t]=[]),this._eventHandlers[t].push({name:n,callback:r})},removeEventHandler:function(t){if(n.isNullOrEmpty(t)||!n.stringContains(t,"."))throw new Error('"eventName" must be a non null or empty string and be a named event (ex. foo.beforeFetch).');var r=this._parseEventName(t),i=this._eventHandlers[r.event];e.isArray(i)&&n.arrayRemoveValue(i,r.name,function(e){return e.name===r.name})},_parseEventName:function(e){var t=e.indexOf(".");return{name:e.substring(t+1),event:e.substring(0,t)}}},r.EventManager.extend=t,r.components.registerComponent("eventManager",function(){return new r.EventManager}),r.registerEventHandler=function(e,t){r.components.eventManager().registerEventHandler(e,t)},r.removeEventHandler=function(e){r.components.eventManager().removeEventHandler(e)}}(r.extend,r.utils),function(t,n,i,s,o,a){r.ViewModel=function(){this.element=null};var u=e.extend(!0,{},n,i,s,o,a,{_initialize:null,dispose:function(){this._disposeAllSubscriptions(),this._disposeBindings(),e.isFunction(this._handleDispose)&&this._handleDispose.call(this),delete this}});r.ViewModel.prototype=u,r.ViewModel.extend=t}(r.extend,r._ViewModel.Bindable,r._ViewModel.Disposable,r._ViewModel.Extendable,r._ViewModel.Http,r._ViewModel.HttpEvent),function(t,n,i,s){r.ComponentViewModel=function(){};var o=e.extend(!0,{},n,i,s,{_initialize:null,dispose:function(){this._disposeAllSubscriptions(),e.isFunction(this._handleDispose)&&this._handleDispose.call(this),delete this}});r.ComponentViewModel.prototype=o,r.ComponentViewModel.extend=t}(r.extend,r._ViewModel.Disposable,r._ViewModel.Extendable,r._ViewModel.Http),r});