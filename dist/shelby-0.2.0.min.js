/*
 * Shelby JavaScript library v0.2.0
 * (c) Patrick Lafrance - https://github.com/patricklafrance/shelby
 * License: MIT (http://www.opensource.org/licenses/mit-license.php) 
 */

!function(t){"use strict";if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var e=t(require("jquery"),require("knockout"),require("knockout.viewmodel"));"object"==typeof exports&&(exports=e),"object"==typeof module&&(module.exports=e)}else if("function"==typeof define&&define.amd)define("shelby",["jquery","knockout","knockout.viewmodel"],t);else{var n=window||global;n.Shelby=t(n.jQuery,n.ko,n.ko.viewmodel)}}(function(t,e,n){"use strict";var r={};return r.version="0.2.0",r.namespace="shelby",r.debug=!1,function(e,n){var i=t.isFunction(Object.hasOwnProperty),s=t.isFunction(Object.keys),o=t.isFunction(Array.prototype.indexOf),u=t.isFunction(Array.prototype.map),a=0;r.utils={isUndefined:function(t){return t===n},isNull:function(t){return this.isUndefined(t)||null===t},isNullOrEmpty:function(t){return this.isNull(t)||""===t},isString:function(t){return"[object String]"===Object.prototype.toString.call(t)},isObject:function(e){return t.isFunction(e)||t.isArray(e)?!1:e===Object(e)},isjQueryElement:function(t){return t instanceof jQuery},isDomElement:function(t){try{if("html"===t.ownerDocument.documentElement.tagName.toLowerCase())return!0}catch(e){}return!1},hasOwnProperty:function(t,e){return i?t.hasOwnProperty(e):e in t},hasProperty:function(t,e){return e in t},clonePlainObject:function(e){return t.extend(!0,{},e)},cloneArray:function(t){return t.slice(0)},arrayIndexOf:function(t,e,n,r){if(!o||n){this.isNull(n)&&(n=function(t){return t===e});for(var i=0,s=t.length;s>i;i+=1)if(n.apply(r,[t[i],e])===!0)return i;return-1}return t.indexOf(e)},arrayGetValue:function(t,e,n){var r=this.arrayIndexOf(t,e,n);return-1!==r?t[r]:null},arrayRemoveIndex:function(t,e){t.splice(e,1)},arrayRemoveValue:function(t,e,n){var r=this.arrayIndexOf(t,e,n);-1!==r&&this.arrayRemoveIndex(t,r)},arrayClear:function(t){for(;t.length>0;)t.pop()},arrayMap:function(t,e,n){if(!u){for(var r=[],i=0,s=t.length;s>i;i+=1)r.push(e.apply(n,[t[i],i,t]));return r}return t.map(e,n)},arrayMapToObject:function(t,e,n){for(var r={},i=0,s=t.length;s>i;i+=1)r[t[i][e]]=t[i][n];return r},objectMap:function(t,e,n){var r={};for(var i in t)this.hasOwnProperty(t,i)&&(r[i]=e.apply(n,[t[i],i,t]));return r},objectKeys:function(t){if(!s){var e=[];for(var n in t)this.hasOwnProperty(t,n)&&e.push(n);return e}return Object.keys(t)},objectSize:function(t){return this.objectKeys(t).length},isImplementing:function(t,e){if(0===e.length)return!1;for(var n=0,r=e.length;r>n;n+=1)if(!(e[n]in t))return!1;return!0},isPartiallyImplementing:function(t,e){for(var n=0,r=e.length;r>n;n+=1)if(e[n]in t)return!0;return!1},isImplementingShelby:function(t){return this.hasProperty(t,e)},stringFormat:function(){var t=arguments,e=t[0];return e.replace(/\{(\d+)\}/g,function(e,n){return t[n]})},stringContains:function(t,e){return-1!==t.indexOf(e)},stringEndsWith:function(t,e){return-1!==t.indexOf(e,t.length-e.length)},stringEnsureEndsWith:function(t,e){return this.stringEndsWith(t,e)?t:t+e},debug:function(t){if(this.isNull(console.log))throw new Error(t);console.log(t)},generateGuid:function(){return a+=1,"__shelby__"+a}}}(r.namespace),function(e){r.extend=function(){if(0===arguments.length)throw new Error("At least 1 non-null plain object is required to extend a Shelby object.");var n=[];t.each(arguments,function(t,r){if(!e.isObject(r))throw new Error("Only non-null literal or prototyped object can extend a Shelby object.");n.push(e.isNull(r.prototype)?r:r.prototype)});var i=this,s=null,o=t.extend.apply(t,[!0,{},i.prototype].concat(n));return s=t.isFunction(o._initialize)?function(){i.apply(this,arguments),t.isFunction(o._initialize)&&o._initialize.apply(this,arguments)}:function(){i.apply(this,arguments)},s.prototype=o,s.prototype._super=i.prototype,s.extend=r.extend,s}}(r.utils),function(e,n){var i=r.ComponentsFactory=function(){this._components={},this._instances={}};r.ComponentsFactory.prototype={registerComponent:function(e,r){if(n.isNullOrEmpty(e))throw new Error('"name" must be a non-null or empty component name.');if(!t.isFunction(r))throw new Error('"factory" must be a function to create instances of the component.');this._components[e]=r},getComponent:function(e){var r=this._instances[e];if(n.isNull(r)){var i=this._components[e];if(!t.isFunction(i))throw new Error(n.stringFormat("Cannot find a component factory for {1}",e));r=this._instances[e]=i()}return r}},i.extend=e;var s=r.components={factory:null,setComponentFactory:function(t){if(n.isNull(t))throw new Error('"factory" must be an object.');this.factory=t},registerComponent:function(t,e){this.factory.registerComponent(t,e)}};t.each(["filters","propertyExtender","parser","ajax","mapper"],function(){var t=this;s[t]=function(){return s.factory.getComponent(t)}}),s.setComponentFactory(new i)}(r.extend,r.utils),function(n,i){r.Parser=function(){this._current=null,this._options=null,this._context=null},r.Parser.prototype={parse:function(t,e,n){if(i.isNull(t))throw new Error('"obj" must be a non-null object.');this._reset(t,e,n),this._next("{root}",t,"",null)},_reset:function(t,e,n){this._current=t,this._options=this._computeOptions(e),this._context=n},_computeOptions:function(e){return e=i.isNull(e)?{}:i.clonePlainObject(e),t.isFunction(e.filter)||(e.filter=function(){return!0}),e},_next:function(e,n,r,s){var o=this._augmentPath(r,e);return this._options.filter.apply(this,[e,n,r])?this._isArray(n)?this._array(e,n,o,s):i.isObject(n)?this._object(e,n,o,s):t.isFunction(n)?this._scalar(e,n,o,s,this._options.onFunction):this._scalar(e,n,o,s,this._options.onPrimitive):!0},_object:function(t,e,n,r){var s=this._scalar(t,e,n,r,this._options.onObject);if(s!==!1)for(var o in e)if(i.hasOwnProperty(e,o)&&(s=this._next(o,e[o],n,e),s===!1))break;return s},_array:function(t,n,r,i){var s=this._scalar(t,n,r,i,this._options.onArray);if(s!==!1)for(var o=e.utils.peekObservable(n),u=0,a=o.length;a>u&&(s=this._next("[i]",o[u],r,n),s!==!1);u+=1);return s},_scalar:function(e,n,r,i,s){if(t.isFunction(s)){var o={key:e,value:n,path:r,parent:i,obj:this._current};return s.call(this._context,o)}},_isArray:function(n){return n=e.utils.peekObservable(n),t.isArray(n)},_augmentPath:function(t,e){return"{root}"===e?e:"[i]"===e?t+e:i.stringFormat("{1}.{2}",t,e)}},r.Parser.extend=n,r.components.registerComponent("parser",function(){return new r.Parser})}(r.extend,r.utils),function(n,i,s){r.Filters=function(){},r.Filters.prototype={getExtendablePropertyFilter:function(){return function(t,r){return t!==n&&(e.isObservable(r)||s.isObject(r))}},getExtendedPropertyFilter:function(){return function(t,r){return t!==n&&(e.isObservable(r)||s.isObject(r))&&s.isImplementingShelby(r)}},getPathFilter:function(e,n){return t.isArray(e)?this._getIncludePathFilter(e):t.isArray(n)?this._getExcludePathFilter(n):this._getDefaultPathFilter()},_getIncludePathFilter:function(t){var e=this,n=this._computeEvaluators(t);return function(t){var r=null,i=!1,o=function(e){return r=e(t),r.isValid&&!r.isPerfectMatch?(i=!0,!1):r.isValid};return-1===s.arrayIndexOf(n,t,o)?i?e._createImperfectMatchEvaluationResult():e._createInvalidEvaluationResult():r}},_getExcludePathFilter:function(t){var e=this,n=this._computeEvaluators(t);return function(t){var r=function(e){var n=e(t);return n.isValid&&n.isPerfectMatch};return-1===s.arrayIndexOf(n,t,r)?e._createPerfectMatchEvaluationResult():e._createInvalidEvaluationResult()}},_getDefaultPathFilter:function(){var t=this;return function(){return t._createPerfectMatchEvaluationResult()}},_computeEvaluators:function(t){var e=this;return s.arrayMap(t,function(t){if(s.stringEndsWith(t,"[i]")){var n=null;try{n=new RegExp(t.replace(/\[i\]/g,"[^]+"))}catch(r){n=new RegExp(t.replace(/\[i\]/g,"[^]]+"))}return function(r){return n.test(r)?e._createPerfectMatchEvaluationResult():e._isArrayPath(t,r)?e._createImperfectMatchEvaluationResult():e._createInvalidEvaluationResult()}}return function(n){return t===n?e._createPerfectMatchEvaluationResult():e._isArrayPath(t,n)?e._createImperfectMatchEvaluationResult():e._createInvalidEvaluationResult()}})},_createInvalidEvaluationResult:function(){return this._createEvaluationResult(!1,!1)},_createImperfectMatchEvaluationResult:function(){return this._createEvaluationResult(!0,!1)},_createPerfectMatchEvaluationResult:function(){return this._createEvaluationResult(!0,!0)},_createEvaluationResult:function(t,e){return{isValid:t,isPerfectMatch:e}},_isArrayPath:function(t,e){return-1!==t.indexOf(e+"[i]")}},r.Filters.extend=i,r.components.registerComponent("filters",function(){return new r.Filters})}(r.namespace,r.extend,r.utils),function(e,n,i){var s=r.PropertyType={Object:0,Array:1,Scalar:2};r.Extenders={},r.Extenders.base=function(t){i.isNull(this._target)&&(this._target=function(){return t})},r.Extenders.base.extend=n,r.PropertyExtender=function(){},r.PropertyExtender.prototype={add:function(t,n){if(i.isNull(t))throw new Error('"target" must be an object.');if(i.isNull(n))throw new Error('"extenders" must be an object literal.');if(!i.hasProperty(t,e)){var o=this,u=function(t){return function(e){o._extendProperty(e,t,n)}};r.components.parser().parse(t,{filter:r.components.filters().getExtendablePropertyFilter(),onObject:u(s.Object),onArray:u(s.Array),onFunction:u(s.Scalar)})}},remove:function(t){if(i.isNull(t))throw new Error('"target" must be an object.');var n=function(t){delete t.value[e]};r.components.parser().parse(t,{filter:r.components.filters().getExtendedPropertyFilter(),onObject:n,onArray:n,onFunction:n})},_extendProperty:function(n,r,s){n.value[e]={};var o=s["*"]||{};i.isObject(s[n.path])&&t.extend(o,s[n.path]),t.each(o,function(){this.apply(this,[n.value,r])})}},r.PropertyExtender.extend=n,r.components.registerComponent("propertyExtender",function(){return new r.PropertyExtender})}(r.namespace,r.extend,r.utils),function(n,i,s){var o=r.PropertyType;e.extenders.shelbySubscribe=function(e){var r=!1;return t.extend(e[n],{subscribe:function(n){if(!t.isFunction(n))throw new Error("First argument must be a callback function.");var i=n;arguments[0]=function(t){r||o.isPause||i.apply(this,[t])};var s=e.subscribe.apply(e,arguments),o={isPause:!1,pause:function(){this.isPause=!0},resume:function(){this.isPause=!1},dispose:function(){s.dispose()}};return o},pause:function(){r=!0},resume:function(){r=!1},isPause:function(){return r}}),e},e.extenders.shelbyArraySubscribe=function(e){var r=e[n].subscribe;if(!t.isFunction(r))throw new Error('The observable must be extended with "ko.extenders.shelbySubscribe".');t.extend(e[n],{subscribe:function(e){var n=!s.isObject(arguments[3])||arguments[3].evaluateChanges!==!1;if(n){if(!t.isFunction(e))throw new Error("First argument must be a callback function.");var i=e;arguments[0]=function(t){i.apply(this,[{value:t},!0,"shelbyArraySubscribe"])},arguments[2]="arrayChange"}return r.apply(this,arguments)}})},r.Extenders.subscribe=function(e,i){if(i!==o.Object){if(e.extend(this._observableExtenders["*"]),i===o.Array){var u=this._observableExtenders.array;s.isNull(u)||e.extend(u)}e[n]._subscriptions={}}i===o.Object&&t.extend(e[n],new r.Extenders.subscribe._ctor(e))},r.Extenders.subscribe._ctor=r.Extenders.base.extend({_initialize:function(){this._delegatedSubscriptions={}},subscribe:function(t,e){if(s.isNull(t))throw new Error('"callback" must be a function.');var n=this;e=e||{},e.array=e.array||{};var i=r.components.filters().getPathFilter(e.include,e.exclude),o={id:s.generateGuid(),members:[],isPause:!1,callback:t,pause:function(){n._pauseSubscription(this)},resume:function(){n._resumeSubscription(this)},dispose:function(){n._disposeSubscription(this)}};return this._addToSubscription(this._target(),o,i,e,{path:""}),o.members.length>0&&(this._delegatedSubscriptions[o.id]=o),o},_addToSubscription:function(e,i,o,u,a){var l=this,c=t.isFunction(u.subscriber)?u.subscriber:this._propertySubscriber,p=function(e){if(s.isImplementingShelby(e.value)){var r=s.isNullOrEmpty(a.path)?e.path:s.stringFormat("{1}{2}",a.path,e.path.replace("{root}","")),p=s.isNull(a.parent)?e.parent:a.parent,f=o(r);if(f.isValid){var d=function(n,s,a){var c={path:r,parent:p,subscription:i};t.extend(c,s===!0?n:{value:n}),"shelbyArraySubscribe"===a&&u.array.trackChildren!==!1&&t.each(n.value,function(){"added"===this.status?l._addToSubscription(this.value,i,o,u,{path:r+"[i]",parent:e.value}):"deleted"===this.status&&l._removeFromSubscription(this.value,i)}),f.isPerfectMatch&&i.callback.call(this,c)},h=c(e,d,u);e.value[n]._subscriptions[i.id]=h,i.members.push(e.value)}}};r.components.parser().parse(e,{filter:r.components.filters().getExtendedPropertyFilter(),onArray:p,onFunction:p})},_removeFromSubscription:function(t,e){var i=function(t){var r=t.value[n]._subscriptions[e.id];s.isNull(r)||(r.dispose(),delete t.value[n]._subscriptions[e.id],s.arrayRemoveValue(e.members,t.value))};r.components.parser().parse(t,{filter:r.components.filters().getExtendedPropertyFilter(),onArray:i,onFunction:i})},_propertySubscriber:function(e,r,i){var o=null;return!t.isArray(e.value.peek())||i.array.evaluateChanges!==!1&&s.isNullOrEmpty(i.event)||(o={evaluateChanges:!1}),e.value[n].subscribe(r,i.callbackTarget,i.event,o)},_pauseSubscription:function(t){this._executeSubscriptionOperation(t,function(t){t.pause()}),t.isPause=!0},_resumeSubscription:function(t){this._executeSubscriptionOperation(t,function(t){t.resume()}),t.isPause=!1},_disposeSubscription:function(t){this._executeSubscriptionOperation(t,function(t){t.dispose()}),s.arrayClear(t.members),delete this._delegatedSubscriptions[t.id]},_executeSubscriptionOperation:function(e,r){t.each(e.members,function(){var t=this[n]._subscriptions[e.id];s.isNull(t)||r(t)})},unsuscribeAll:function(){var e=this;t.each(this._delegatedSubscriptions,function(){e._disposeSubscription(this)})},mute:function(){var e=this;t.each(this._delegatedSubscriptions,function(){e._pauseSubscription(this)})},unmute:function(){var e=this;t.each(this._delegatedSubscriptions,function(){e._resumeSubscription(this)})}}),r.Extenders.subscribe._ctor.extend=i,r.Extenders.subscribe._observableExtenders={"*":{shelbySubscribe:!0},array:{shelbyArraySubscribe:!0}}}(r.namespace,r.extend,r.utils),function(n,i,s){var o=r.PropertyType;e.extenders.shelbyEdit=function(r){if(!t.isFunction(r[n].pause)||!t.isFunction(r[n].resume))throw new Error(s.stringFormat('"shelbyEditable" can only extends an observable having "{1}.pause" and "{1}.resume" functions.',n));var i=!1;return t.extend(r[n],{current:r.peek(),hasMutated:!1,isEditing:!1,deferNotifications:!1,beginEdit:function(t){this.isEditing||(this.current=r.peek(),this.deferNotifications=t!==!1?!0:!1,this.deferNotifications&&(i=r[n].isPause(),i||r[n].pause()),this.isEditing=!0)},endEdit:function(t){var e=this;if(this.isEditing&&this.hasMutated&&(this.current=r.peek()),this.isEditing&&!i&&this.deferNotifications!==!1){var s=e.hasMutated;setTimeout(function(){r[n].resume(),s&&t!==!1&&(r.valueWillMutate(),r.valueHasMutated())},10)}this.hasMutated=!1,this.isEditing=!1},resetEdit:function(){this.isEditing&&this.hasMutated&&r(this.current)},cancelEdit:function(){r[n].resetEdit(),this.isEditing&&(i||this.deferNotifications===!1||setTimeout(function(){r[n].resume()},10)),this.isEditing=!1,this.hasMutated=!1}}),r.subscribe(function(i){s.isNull(r[n])||!r[n].isEditing||r[n].hasMutated||(r[n].hasMutated=t.isArray(i)?0===e.utils.compareArrays(r[n].current,i).length:i!==r[n].current)}),r},r.Extenders.edit=function(e,i){i!==o.Object&&e.extend(this._observableExtenders),i===o.Object&&t.extend(e[n],new r.Extenders.edit._ctor(e))},r.Extenders.edit._ctor=r.Extenders.base.extend({_initialize:function(){this.isEditing=!1,this._editOptions=null},beginEdit:function(t){this.isEditing||(this._editOptions=t||{},this._executeEditAction(function(t){t.value[n].beginEdit(this._editOptions.deferNotifications)}),this.isEditing=!0)},endEdit:function(t){if(this.isEditing){var e=null;if(t===!0){if(this._editOptions.deferNotifications===!0)throw new Error('The "notify once" options is not supported when the edition has been started with the "defer notifications" disabled.');e=function(t){return 1===t.count}}else e=function(){return!0};var r=function(t,r){t.value[n].isEditing===!0&&(t.value[n].hasMutated&&(r.count+=1),t.value[n].endEdit(e(r)))};this._executeEditAction(r,{count:0}),this.isEditing=!1}},resetEdit:function(){this.isEditing&&this._executeEditAction(function(t){t.value[n].isEditing===!0&&t.value[n].resetEdit()})},cancelEdit:function(){this.isEditing&&(this._executeEditAction(function(t){t.value[n].isEditing===!0&&t.value[n].cancelEdit()}),this.isEditing=!1)},hasMutated:function(){var t=!1;return this.isEditing&&this._executeEditAction(function(e){return e.value[n].hasMutated?(t=!0,!1):void 0}),t},_executeEditAction:function(t,e){var n=this,i=r.components.filters().getPathFilter(this._editOptions.include,this._editOptions.exclude),s=function(r){return i(r.path).isPerfectMatch?t.apply(n,[r,e]):void 0};r.components.parser().parse(this._target(),{filter:r.components.filters().getExtendedPropertyFilter(),onArray:s,onFunction:s})}}),r.Extenders.edit._ctor.extend=i,r.Extenders.edit._observableExtenders={shelbyEdit:!0}}(r.namespace,r.extend,r.utils),function(e,n,i){var s=r.PropertyType;r.Extenders.utility=function(n,i){i!==s.Scalar&&t.extend(n[e],new r.Extenders.utility._ctor(n))},r.Extenders.utility._ctor=r.Extenders.base.extend({reset:function(){var t=null,e={};i.isObject(arguments[1])?(t=arguments[0],e=arguments[1]):i.isObject(arguments[0])?e=arguments[0]:arguments.length>0&&(t=arguments[0]);var n=function(n){n.value(i.hasProperty(e,n.path)?e[n.path]:t)};r.components.parser().parse(this._target(),{filter:r.components.filters().getExtendedPropertyFilter(),onFunction:n})},updateFrom:function(t){if(!i.isObject(t))throw new Error('"obj" must be an object.');try{r.components.mapper().update(this._target(),t)}catch(e){throw new Error("An error occurred while updating the target object. Make sure that all the observables properties of the target object has been created by the Shelby mapper.")}}}),r.Extenders.utility._ctor.extend=n}(r.namespace,r.extend,r.utils),function(e,n,i){var s=r.Ajax=function(){};s.prototype={send:function(n){if(i.isNull(n))throw new Error('"options" must be a non null object literal.');if(i.isNullOrEmpty(n.url))throw new Error('"options.url" must be a non null or empty string.');if(i.isNullOrEmpty(n.type))throw new Error('"options.type" must be a non null or empty string.');var r=t.extend({},t.ajaxSettings,s.options,n),o=i.isObject(n.data);o||(r.contentType=null),"GET"!==n.type&&o&&i.stringContains(r.contentType,"application/json")&&(r.data=JSON.stringify(r.data));var u=t.ajax(r);return e===!0&&u.fail(this._onRequestFail),u},_onRequestFail:function(t,e,n){var r=i.isNullOrEmpty(this.data)?"{NO_DATA}":JSON.stringify(this.data),s=i.isNullOrEmpty(e)?"{NO_EXCEPTION}":e,o=i.isNullOrEmpty(n)?"{NO_HTTP_ERROR}":n,u=i.stringFormat("An error occurred while performing an AJAX request of type {1} to {2} with data {3}.\nStatus code: {4}\nStatus text: {5}\nException: {6}\nHTTP error: {7}",this.type,this.url,r,t.status,t.statusText,s,o);i.debug(u)}},s.options=t.extend({},t.ajaxSettings,{contentType:"application/json",cache:!1}),s.extend=n,r.components.registerComponent("ajax",function(){return new s})}(r.debug,r.extend,r.utils),function(t){r.Mapper=function(){},r.Mapper.prototype={fromJS:function(){return n.fromModel.apply(n,arguments)},toJS:function(){return n.toModel.apply(n,arguments)},update:function(){return n.updateFromModel.apply(n,arguments)}},r.Mapper.extend=t,r.components.registerComponent("mapper",function(){return new r.Mapper})}(r.extend),r._ViewModel={},function(n){r._ViewModel.Bindable={_beforeBind:null,_afterBind:null,bind:function(e){var n=this,r=new t.Deferred,i=function(){n._applyBindings(),r.resolve()};if(this.element=this._getDomElement(e),t.isFunction(this._beforeBind)){var s=this._beforeBind.call(this,i);s!==!0&&i()}else i();return r.promise()},_getDomElement:function(t){return n.isjQueryElement(t)&&t.length>0&&(t=t[0]),t},_applyBindings:function(){e.applyBindings(this,this.element),t.isFunction(this._afterBind)&&this._afterBind.call(this)},_disposeBindings:function(){n.isDomElement(this.element)&&e.dataFor(this.element)&&e.cleanNode(this.element)}}}(r.utils),function(){r._ViewModel.Disposable={_handleDispose:null}}(),function(t,e){r._ViewModel.Extendable={_fromJS:function(t,e){var n=r.components.mapper().fromJS(t,e);return this._applyExtendersToObject(n),n},_toJS:function(t){var e=r.components.mapper().toJS(t);return this._removeExtendersFromObject(e),e},_applyExtendersToObject:function(t){e.objectSize(this._extenders)>0&&r.components.propertyExtender().add(t,this._extenders)},_removeExtendersFromObject:function(t){r.components.propertyExtender().remove(t)},_disposeAllSubscriptions:function(){var n=function(n){e.hasProperty(n.value,t)&&e.hasProperty(n.value[t],"unsuscribeAll")&&n.value[t].unsuscribeAll()};r.components.parser().parse(this,{filter:r.components.filters().getExtendedPropertyFilter(),onObject:n})}},r._ViewModel.Extendable._extenders={"*":{utility:r.Extenders.utility,subscribe:r.Extenders.subscribe,edit:r.Extenders.edit}}}(r.namespace,r.utils),function(e,n){r._ViewModel.Http={_url:null,_send:function(e,i){if(n.isNullOrEmpty(e.request.url))throw new Error('"options.request.url" must be a non null or empty string.');var s=this,o=t.extend({context:this},e.request),u=new r.OperationContext(o);t.isFunction(i.onBefore)&&(o.beforeSend=function(){var e=t.makeArray(arguments);return e.unshift(u),i.onBefore.apply(this,e)}),n.isObject(o.data)&&(o.data=this._toJS(o.data));var a=r.components.ajax().send(o),l=t.Deferred();return a.done(function(r){n.isNull(r)||(e.response=e.response||{},e.response.process!==!1&&(t.isFunction(e.response.extractor)&&(r=e.response.extractor.call(this,r)),t.isFunction(i.onResponse)&&(r=i.onResponse.apply(s,[r,e])))),l.resolveWith(this,[r]),t.isFunction(s._handleOperationSuccess)&&s._handleOperationSuccess.call(this,u)}),a.fail(function(e,n){var i=new r.RequestError(u,e,n);l.rejectWith(this,[i]),t.isFunction(s._handleOperationError)&&s._handleOperationError.call(this,i)}),t.isFunction(i.onAfter)&&a.always(function(){var e=t.makeArray(arguments);e.unshift(u),i.onAfter.apply(this,e)}),l.promise()},_fetch:function(t){if(n.isNull(t))throw new Error('"options" must be a non null object literal.');if(n.isNull(t.request))throw new Error('"options.request" must be a non null object literal.');return t.request.type=t.request.type||"GET",this._send(t,{onBefore:this._beforeFetch,onAfter:this._afterFetch,onResponse:function(e){return this._fromJS(e,t.response.mapping)}})},_save:function(t){if(n.isNull(t))throw new Error('"options" must be a non null object literal.');if(n.isNull(t.request))throw new Error('"options.request" must be a non null object literal.');if(n.isNullOrEmpty(t.request.type))throw new Error('"options.request.type" must be a non nullor empty string.');return this._send(t,{onBefore:this._beforeSave,onAfter:this._afterSave,onResponse:function(t,e){return n.isObject(e.request.data)&&n.isObject(t)&&r.components.mapper().update(e.request.data,t),t}})},_remove:function(t){if(n.isNull(t))throw new Error('"options" must be a non null object literal.');if(n.isNull(t.request))throw new Error('"options.request" must be a non null object literal.');return t.request.type=t.request.type||"DELETE",this._send(t,{onBefore:this._beforeSave,onAfter:this._afterSave})},all:function(e,n){var r=this._getUrl("all"),i={request:{url:r.value,data:e},response:n};return this._fetch(t.extend({},i,n))},detail:function(e,r){if(n.isNullOrEmpty(e))throw new Error('"id" must be a non null or empty string.');var i=this._getUrl("detail"),s={request:{url:i.value,data:{id:e}}};return this._fetch(t.extend(s,r))},add:function(e,r){if(n.isNull(e))throw new Error('"model" must be a non null object.');var i=this._getUrl("add"),s={request:{url:i.value,type:"POST",data:e}};return this._save(t.extend(s,r))},update:function(){var e=null,r=null,s=null,o=this._getUrl("update"),u=o.type===i.Rest;if(u)switch(arguments.length){case 3:e=arguments[0],r=arguments[1],s=arguments[2];break;case 2:n.isString(arguments[0])?(e=arguments[0],r=arguments[1]):(r=arguments[0],s=arguments[1]);break;default:r=arguments[0]}else r=arguments[0],s=arguments[1];if(n.isNull(r)||!n.isObject(r))throw new Error('"model" must be a non null object.');u&&n.isString(e)&&(o.value=n.stringFormat("{1}/{2}",o.value,e));var a={request:{url:o.value,type:u?"PUT":"POST",data:r}};return this._save(t.extend(a,s))},remove:function(e,r){var s=this._getUrl("remove"),o=s.type===i.Rest;if(o)if(n.isString(e)){if(n.isNullOrEmpty(e))throw new Error('"target" id must be a non empty string.');s.value=n.stringFormat("{1}/{2}",s.value,e)}else if(!n.isObject(e))throw new Error('"target" must be a non null or empty string identifier or a non null object model.');var u={request:{url:s.value,type:o?"DELETE":"POST",data:n.isObject(e)?e:null}};return this._remove(t.extend(u,r))},_getUrl:function(t){if(!n.isNullOrEmpty(this._url)){if(n.isString(this._url))return{value:this._url,type:i.Rest};if(n.isObject(this._url)){var e=this._url[t];if(n.isNullOrEmpty(e))throw new Error(n.stringFormat('The URL for the operation "{1}" is not specified.',t));return{value:e,type:i.Rpc}}}throw new Error('To use any of the AJAX operations, the "_url" property must be a non-null/empty string or a non-null object literal.')}};var i=r.UrlType={Rest:"REST",Rpc:"RPC"}}(r.extend,r.utils),function(t){r._ViewModel.HttpNotifications={_beforeFetch:null,_beforeSave:null,_beforeRemove:null,_afterFetch:null,_afterSave:null,_afterRemove:null,_handleOperationError:null,_handleOperationSuccess:null};var e=r.OperationMethod={Get:"GET",Post:"POST",Put:"PUT",Delete:"DELETE",fromHttpVerb:function(t){var n=e.Get;return"POST"===t?n=e.Post:"PUT"===t?n=e.Put:"DELETE"===t&&(n=e.Delete),n}};r.OperationContext=function(t){this.url=t.url,this.method=e.fromHttpVerb(t.type),this.data=t.data},r.RequestError=function(e,n,r){var i=null;i=t.isNull(n.responseJSON)?t.isNull(n.responseXML)?n.responseText:n.responseXML:n.responseJSON,e.statusCode=n.status,e.statusText=n.statusText,e.exception=r,this.operationContext=e,this.response=i}}(r.utils),function(e,n,i,s,o,u){r.ViewModel=function(){this.element=null};var a=t.extend(!0,{},n,i,s,o,u,{_initialize:null,dispose:function(){this._disposeAllSubscriptions(),this._disposeBindings(),t.isFunction(this._handleDispose)&&this._handleDispose.call(this),delete this}});r.ViewModel.prototype=a,r.ViewModel.extend=e}(r.extend,r._ViewModel.Bindable,r._ViewModel.Disposable,r._ViewModel.Extendable,r._ViewModel.Http,r._ViewModel.HttpNotifications),function(e,n,i,s){r.ComponentViewModel=function(){};var o=t.extend(!0,{},n,i,s,{_initialize:null,dispose:function(){this._disposeAllSubscriptions(),t.isFunction(this._handleDispose)&&this._handleDispose.call(this),delete this}});r.ComponentViewModel.prototype=o,r.ComponentViewModel.extend=e}(r.extend,r._ViewModel.Disposable,r._ViewModel.Extendable,r._ViewModel.Http),r});